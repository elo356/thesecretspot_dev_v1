<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel del Cliente - The Secret Spot</title>

<style>
/* GLOBAL */
body {
    margin: 0;
    font-family: "Inter", sans-serif;
    background: #f5f6fa;
    color: #333;
    display: flex;
    height: 100vh;
}

/* SIDEBAR */
.sidebar {
    width: 240px;
    background: #111827;
    color: white;
    display: flex;
    flex-direction: column;
    padding: 20px;
}

.sidebar h1 {
    font-size: 18px;
    margin-bottom: 25px;
    text-align: center;
}

.sidebar button {
    width: 100%;
    text-align: left;
    padding: 12px;
    margin-bottom: 8px;
    background: #1f2937;
    border: none;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
}
.sidebar button:hover {
    background: #374151;
}

.logout-btn {
    margin-top: auto;
    background: #dc2626 !important;
}

/* MOBILE MENU */
.menu-toggle {
    display: none;
    position: fixed;
    top: 15px;
    left: 15px;
    background: #111827;
    color: white;
    border: none;
    padding: 8px 12px;
    font-size: 26px;
    border-radius: 6px;
    z-index: 999;
}

@media (max-width: 850px) {
    .menu-toggle { display: block; }
    .sidebar {
        position: fixed;
        left: 0; top: 0;
        height: 100vh;
        transform: translateX(-250px);
        transition: .3s;
        z-index: 999;
    }
    .sidebar.open {
        transform: translateX(0);
    }
}

/* MAIN */
main {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
}

.hidden-section {
    display: none;
}

.status {
    font-size: 14px;
    color: #666;
    margin-bottom: 15px;
}

/* CARDS */
.card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    margin-bottom: 20px;
}

.card h2 {
    margin: 0 0 10px;
}

input, select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-top: 6px;
}

button.action {
    margin-top: 10px;
    padding: 10px;
    background: #111827;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

button.secondary {
    background: #dc2626 !important;
}

/* LIST PREVIEW */
.preview-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
    margin-top: 10px;
}

.preview-item {
    background: #f9fafb;
    border: 1px solid #ddd;
    padding: 8px;
    border-radius: 8px;
}

.preview-item img {
    width: 100%;
    border-radius: 8px;
}

.preview-scroll {
    max-height: 240px;
    overflow-y: auto;
}

/* LOADER */
#uploadLoader {
    display: none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.6);
    color:white;
    text-align:center;
    padding-top:40vh;
    font-size:22px;
    z-index: 999999;
}
</style>
</head>

<body>

<button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
    <h1>The Secret Spot</h1>

    <button onclick="showScreen('general')">‚öô General</button>
    <button onclick="showScreen('galeria')">üñº Galer√≠a</button>

    <button class="logout-btn" onclick="logout()">Cerrar sesi√≥n</button>
</aside>

<!-- MAIN CONTENT -->
<main>
    <div class="status" id="status">Cargando contenido...</div>

    <!-- ===================== GENERAL SCREEN ===================== -->
    <div id="screen-general">

        <section class="card">
            <h2>Video del Header</h2>
            <input type="file" id="videoHeaderFile" accept="video/mp4">
            <button class="action" onclick="uploadVideo()">Subir Video</button>
            <div id="headerVideoPreview"></div>
        </section>

        <section class="card">
            <h2>Sobre Nosotros</h2>
            <input type="file" id="sobreNosotrosFile">
            <button class="action" onclick="uploadImage('sobre_nosotros','sobreNosotrosFile')">Subir</button>
            <div class="preview-list" id="sobreNosotrosPreview"></div>
        </section>

        <section class="card">
            <h2>Foto Grupal</h2>
            <input type="file" id="fotoGrupalFile">
            <button class="action" onclick="uploadImage('foto_grupal','fotoGrupalFile')">Subir</button>
            <div class="preview-list" id="fotoGrupalPreview"></div>
        </section>

        <section class="card">
            <h2>Servicios</h2>
            <input type="file" id="serviciosFile">
            <button class="action" onclick="uploadImage('servicios','serviciosFile')">A√±adir</button>
            <div class="preview-scroll">
                <div class="preview-list" id="serviciosPreview"></div>
            </div>
        </section>

        <section class="card">
            <h2>Equipo</h2>
            <input type="file" id="equipoFile">
            <button class="action" onclick="uploadImage('equipo','equipoFile')">A√±adir</button>
            <div class="preview-scroll">
                <div class="preview-list" id="equipoPreview"></div>
            </div>
        </section>

    </div>

    <!-- ===================== GALERIA SCREEN ===================== -->
    <div id="screen-galeria" class="hidden-section">

        <section class="card">
            <h2>Galer√≠a</h2>

            <input type="file" id="galeriaFile">
            <select id="galeriaCategoria">
                <option value="manicura-pedicura">Manicura y Pedicura</option>
                <option value="damas">Damas</option>
                <option value="caballeros">Caballeros</option>
                <option value="ninos">Ni√±os</option>
            </select>

            <button class="action" onclick="uploadGaleria()">Subir a galer√≠a</button>

            <br><br>
            <strong>Filtrar:</strong>
            <select id="galeriaFilter" onchange="renderGaleria()">
                <option value="all">Todas</option>
            </select>

            <div class="preview-scroll">
                <div class="preview-list" id="galeriaPreview"></div>
            </div>
        </section>

    </div>

</main>

<div id="uploadLoader">‚è≥ Subiendo archivo...</div>

<script>

/* ========= MENU HANDLING ========= */
function toggleMenu() {
    document.getElementById("sidebar").classList.toggle("open");
}

function showScreen(screen) {
    document.getElementById("screen-general").classList.add("hidden-section");
    document.getElementById("screen-galeria").classList.add("hidden-section");

    document.getElementById(`screen-${screen}`).classList.remove("hidden-section");

    if (window.innerWidth <= 850) {
        document.getElementById("sidebar").classList.remove("open");
    }
}

/* ========= PANEL BACKEND LOGIC (same as your original) ========= */

if (!localStorage.getItem("panel_token")) window.location.href = "login.html";
const API="https://internal-api.tudominio.com.ladiesandmengrooming.com";
const TOKEN=localStorage.getItem("panel_token");

function setStatus(t){ document.getElementById("status").textContent=t; }

async function authorizedFetch(url,options={}) {
    options.headers = options.headers || {};
    options.headers["Authorization"] = TOKEN;
    return fetch(url,options);
}

let state = {
    header_video:"",
    servicios:[],
    sobre_nosotros:"",
    foto_grupal:"",
    equipo:[],
    galeria:[]
};

async function fetchContent(){
    try{
        setStatus("Cargando contenido...");
        const r = await authorizedFetch(`${API}/content`);
        state = await r.json();
        renderAll();
        setStatus("Contenido cargado.");
    } catch(e){
        setStatus("Error cargando contenido.");
    }
}

function showLoader(msg){ const l=document.getElementById("uploadLoader"); l.textContent="‚è≥ "+msg; l.style.display="block"; }
function hideLoader(){ document.getElementById("uploadLoader").style.display="none"; }

async function uploadImage(section,inputId){
    const f=document.getElementById(inputId).files[0];
    if(!f) return alert("Selecciona una imagen");

    showLoader("Subiendo imagen...");
    const fd=new FormData();
    fd.append("section",section);
    fd.append("file",f);

    const r= await fetch(`${API}/upload-image`,{method:"POST",body:fd});
    hideLoader();
    if(!r.ok) return alert("Error al subir");

    document.getElementById(inputId).value="";
    fetchContent();
}

async function uploadGaleria(){
    const f=document.getElementById("galeriaFile").files[0];
    const cat=document.getElementById("galeriaCategoria").value;

    if(!f) return alert("Selecciona una imagen");

    showLoader("Subiendo...");
    const fd=new FormData();
    fd.append("section","galeria");
    fd.append("categoria",cat);
    fd.append("file",f);

    const r= await fetch(`${API}/upload-image`,{method:"POST",body:fd});
    hideLoader();
    if(!r.ok) return alert("Error");

    document.getElementById("galeriaFile").value="";
    fetchContent();
}

async function uploadVideo(){
    const f=document.getElementById("videoHeaderFile").files[0];
    if(!f) return alert("Selecciona un video");

    showLoader("Subiendo video...");
    const fd=new FormData();
    fd.append("file",f);

    const r= await fetch(`${API}/upload-video`,{method:"POST",body:fd});
    hideLoader();
    if(!r.ok) return alert("Error al subir el video");

    fetchContent();
}

async function deleteImage(section,url){
    if(!confirm("¬øEliminar imagen?")) return;

    const r= await authorizedFetch(`${API}/delete-image?section=${section}&url=${url}`,{
        method:"DELETE"
    });

    if(!r.ok) return alert("Error eliminando");
    fetchContent();
}

function renderAll(){
    renderHeaderVideo();
    renderSobreNosotros();
    renderFotoGrupal();
    renderServicios();
    renderEquipo();
    renderGaleria();
}

function renderHeaderVideo(){
    document.getElementById("headerVideoPreview").innerHTML =
        state.header_video ? `<video src="${API}${state.header_video}" controls style="width:100%;border-radius:8px"></video>` : "";
}

function renderSobreNosotros(){
    document.getElementById("sobreNosotrosPreview").innerHTML =
        state.sobre_nosotros ? `
        <div class="preview-item">
            <img src="${state.sobre_nosotros}">
            <button class="secondary action" onclick="deleteImage('sobre_nosotros','${state.sobre_nosotros}')">Eliminar</button>
        </div>` : "";
}

function renderFotoGrupal(){
    document.getElementById("fotoGrupalPreview").innerHTML=
        state.foto_grupal ? `
        <div class="preview-item">
            <img src="${state.foto_grupal}">
            <button class="secondary action" onclick="deleteImage('foto_grupal','${state.foto_grupal}')">Eliminar</button>
        </div>`:"";
}

function renderServicios(){
    document.getElementById("serviciosPreview").innerHTML =
        state.servicios.map(url => `
        <div class="preview-item">
            <img src="${url}">
            <button class="secondary action" onclick="deleteImage('servicios','${url}')">Eliminar</button>
        </div>`).join("");
}

function renderEquipo(){
    document.getElementById("equipoPreview").innerHTML =
        state.equipo.map(url => `
        <div class="preview-item">
            <img src="${url}">
            <button class="secondary action" onclick="deleteImage('equipo','${url}')">Eliminar</button>
        </div>`).join("");
}

function renderGaleria(){
    const filter=document.getElementById("galeriaFilter");
    filter.innerHTML=`<option value="all">Todas</option>`;

    [...new Set(state.galeria.map(g=>g.categoria))].forEach(cat=>{
        filter.innerHTML+=`<option value="${cat}">${cat}</option>`;
    });

    const f=filter.value;
    const imgs=f==="all"?state.galeria:state.galeria.filter(g=>g.categoria===f);

    document.getElementById("galeriaPreview").innerHTML =
        imgs.map(img=>`
        <div class="preview-item">
            <img src="${img.url}">
            <div class="badge">${img.categoria}</div>
            <button class="secondary action" onclick="deleteImage('galeria','${img.url}')">Eliminar</button>
        </div>`).join("");
}

function logout(){
    localStorage.removeItem("panel_token");
    window.location.href="login.html";
}

fetchContent();
showScreen("general"); // default screen

</script>

</body>
</html>
