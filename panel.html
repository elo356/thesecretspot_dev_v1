<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin ¬∑ The Secret Spot</title>
  <style>
    :root{
      --bg:#050505;
      --panel:#151515;
      --primary:#ffb400;
      --danger:#ff4d4d;
      --muted:#aaaaaa;
      --radius:12px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Inter",sans-serif;
      background:radial-gradient(circle at top,#222 0,#050505 60%);
      color:#f5f5f5;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:2rem 1rem;
    }
    .wrap{
      width:100%;
      max-width:1200px;
      display:grid;
      grid-template-columns:260px 1fr;
      gap:1.5rem;
    }
    .sidebar{
      background:rgba(0,0,0,0.85);
      border-radius:var(--radius);
      padding:1.2rem;
      border:1px solid rgba(255,255,255,0.12);
    }
    .logo{
      font-size:0.78rem;
      letter-spacing:0.16em;
      text-transform:uppercase;
      margin-bottom:1.3rem;
      display:flex;
      align-items:center;
      gap:0.5rem;
    }
    .logo span{
      width:26px;height:26px;
      border-radius:8px;
      background:linear-gradient(135deg,#ffb400,#ff6b00);
      display:flex;align-items:center;justify-content:center;
      font-weight:800;color:#000;
    }
    .nav button{
      width:100%;
      text-align:left;
      padding:0.55rem 0.75rem;
      border-radius:8px;
      border:1px solid transparent;
      background:transparent;
      color:#ddd;
      margin-bottom:0.3rem;
      cursor:pointer;
      font-size:0.9rem;
    }
    .nav button.active{
      background:rgba(255,255,255,0.08);
      border-color:rgba(255,255,255,0.18);
    }
    .main{
      background:rgba(0,0,0,0.85);
      border-radius:var(--radius);
      padding:1.3rem 1.5rem;
      border:1px solid rgba(255,255,255,0.12);
    }
    h1{margin:0 0 0.3rem;font-size:1.3rem;}
    .pill{
      display:inline-block;
      padding:0.2rem 0.6rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.2);
      font-size:0.75rem;
      color:var(--muted);
      margin-bottom:1rem;
    }
    .card{
      background:var(--panel);
      border-radius:var(--radius);
      padding:1rem 1.1rem;
      margin-bottom:1rem;
      border:1px solid rgba(255,255,255,0.08);
    }
    .card h2{margin:0 0 0.3rem;font-size:1rem;}
    .card p{margin:0 0 0.6rem;font-size:0.85rem;color:var(--muted);}
    label{
      display:block;
      font-size:0.78rem;
      color:var(--muted);
      margin-bottom:0.2rem;
    }
    input, select{
      width:100%;
      padding:0.5rem 0.7rem;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.2);
      background:#101010;
      color:#fff;
      font-size:0.86rem;
      margin-bottom:0.4rem;
    }
    button.primary{
      background:var(--primary);
      color:#000;
      border:none;
      border-radius:999px;
      padding:0.45rem 0.9rem;
      font-weight:600;
      cursor:pointer;
      font-size:0.9rem;
    }
    button.danger{
      background:var(--danger);
      color:#fff;
      border:none;
      border-radius:999px;
      padding:0.35rem 0.8rem;
      font-size:0.8rem;
      cursor:pointer;
    }
    .status{font-size:0.8rem;color:var(--muted);margin-top:0.2rem;}
    .row{
      display:flex;
      align-items:center;
      gap:0.9rem;
      margin-bottom:0.6rem;
      flex-wrap:wrap;
    }
    .row img{
      width:90px;
      height:70px;
      object-fit:cover;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.2);
      background:#000;
      flex-shrink:0;
    }
    .row > div.flex{
      flex:1;
      min-width:200px;
    }
    .preview-video video{
      width:100%;
      max-width:420px;
      border-radius:10px;
      margin-top:0.5rem;
    }
    .gallery-list{
      max-height:350px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:0.5rem;
      margin-top:0.5rem;
    }
    .gallery-item{
      display:flex;
      align-items:center;
      gap:0.7rem;
      background:rgba(0,0,0,0.4);
      border-radius:10px;
      padding:0.4rem;
      border:1px solid rgba(255,255,255,0.08);
    }
    .gallery-item img{
      width:70px;height:70px;object-fit:cover;border-radius:8px;flex-shrink:0;
    }
    .gallery-meta{flex:1;font-size:0.8rem;}
    .badge{
      display:inline-block;
      padding:0.1rem 0.45rem;
      border-radius:999px;
      font-size:0.7rem;
      text-transform:uppercase;
      letter-spacing:0.08em;
      background:var(--primary);
      color:#000;
      margin-bottom:0.1rem;
    }
    .muted{color:var(--muted);font-size:0.8rem;}
    .hidden{display:none;}
    @media(max-width:900px){
      .wrap{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>

<div class="wrap">
  <aside class="sidebar">
    <div class="logo">
      <span>TS</span> THE SECRET SPOT ¬∑ ADMIN
    </div>
    <div class="nav">
      <button class="active" data-panel="hero" onclick="switchPanel(this,'hero')">üé• Video header</button>
      <button data-panel="servicios" onclick="switchPanel(this,'servicios')">üíà 4 im√°genes de servicios</button>
      <button data-panel="sobre" onclick="switchPanel(this,'sobre')">üìÑ Sobre nosotros</button>
      <button data-panel="grupo" onclick="switchPanel(this,'grupo')">üë• Foto grupal</button>
      <button data-panel="staff" onclick="switchPanel(this,'staff')">üë§ Equipo</button>
      <button data-panel="galeria" onclick="switchPanel(this,'galeria')">üñº Galer√≠a</button>
    </div>
  </aside>

  <main class="main">
    <h1>Panel de administraci√≥n</h1>
    <div class="pill">Cambia video, fotos fijas y galer√≠a</div>

    <!-- HERO -->
    <section id="panel-hero" class="card">
      <h2>Video del header</h2>
      <p>Video de fondo de la secci√≥n principal.</p>
      <input id="heroFile" type="file" accept="video/*">
      <button class="primary" onclick="uploadHeroVideo()">Subir / reemplazar</button>
      <div id="heroStatus" class="status"></div>
      <div class="preview-video">
        <p class="muted">Video actual:</p>
        <div id="heroPreview"></div>
      </div>
    </section>

    <!-- SERVICIOS -->
    <section id="panel-servicios" class="card hidden">
      <h2>4 im√°genes de servicios</h2>
      <p>Im√°genes que se muestran en la secci√≥n de servicios.</p>

      <div class="row">
        <img id="prev-servicio_1" alt="Servicio 1">
        <div class="flex">
          <label>Servicio 1</label>
          <input id="file-servicio_1" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('servicio_1')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-servicio_2" alt="Servicio 2">
        <div class="flex">
          <label>Servicio 2</label>
          <input id="file-servicio_2" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('servicio_2')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-servicio_3" alt="Servicio 3">
        <div class="flex">
          <label>Servicio 3</label>
          <input id="file-servicio_3" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('servicio_3')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-servicio_4" alt="Servicio 4">
        <div class="flex">
          <label>Servicio 4</label>
          <input id="file-servicio_4" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('servicio_4')">Cambiar</button>
      </div>

      <div id="serviciosStatus" class="status"></div>
    </section>

    <!-- SOBRE NOSOTROS -->
    <section id="panel-sobre" class="card hidden">
      <h2>Sobre nosotros</h2>
      <p>Imagen principal de la secci√≥n ‚ÄúSobre Nosotros‚Äù.</p>
      <div class="row">
        <img id="prev-about_img" alt="Sobre nosotros">
        <div class="flex">
          <label>Imagen</label>
          <input id="file-about_img" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('about_img')">Cambiar</button>
      </div>
      <div id="sobreStatus" class="status"></div>
    </section>

    <!-- FOTO GRUPAL -->
    <section id="panel-grupo" class="card hidden">
      <h2>Foto grupal</h2>
      <p>Imagen grupal del equipo.</p>
      <div class="row">
        <img id="prev-team_group" alt="Foto grupal">
        <div class="flex">
          <label>Imagen grupal</label>
          <input id="file-team_group" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('team_group')">Cambiar</button>
      </div>
      <div id="grupoStatus" class="status"></div>
    </section>

    <!-- STAFF -->
    <section id="panel-staff" class="card hidden">
      <h2>Equipo</h2>
      <p>Cada foto individual del staff.</p>

      <div class="row">
        <img id="prev-staff_1" alt="Staff 1">
        <div class="flex">
          <label>Staff 1</label>
          <input id="file-staff_1" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('staff_1')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-staff_2" alt="Staff 2">
        <div class="flex">
          <label>Staff 2</label>
          <input id="file-staff_2" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('staff_2')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-staff_3" alt="Staff 3">
        <div class="flex">
          <label>Staff 3</label>
          <input id="file-staff_3" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('staff_3')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-staff_4" alt="Staff 4">
        <div class="flex">
          <label>Staff 4</label>
          <input id="file-staff_4" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('staff_4')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-staff_5" alt="Staff 5">
        <div class="flex">
          <label>Staff 5</label>
          <input id="file-staff_5" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('staff_5')">Cambiar</button>
      </div>

      <div class="row">
        <img id="prev-staff_6" alt="Staff 6">
        <div class="flex">
          <label>Staff 6</label>
          <input id="file-staff_6" type="file" accept="image/*">
        </div>
        <button class="primary" onclick="uploadSlot('staff_6')">Cambiar</button>
      </div>

      <div id="staffStatus" class="status"></div>
    </section>

    <!-- GALER√çA -->
    <section id="panel-galeria" class="card hidden">
      <h2>Galer√≠a</h2>
      <p>Fotos con categor√≠as para la galer√≠a.</p>

      <label for="galleryFile">Imagen</label>
      <input id="galleryFile" type="file" accept="image/*">

      <label for="galleryCategory">Categor√≠a</label>
      <select id="galleryCategory">
        <option value="damas">Damas</option>
        <option value="caballeros">Caballeros</option>
        <option value="ninos">Ni√±os</option>
        <option value="manicura">Manicura</option>
        <option value="pedicura">Pedicura</option>
      </select>

      <button class="primary" onclick="uploadGalleryImage()">Agregar a la galer√≠a</button>
      <div id="galleryStatus" class="status"></div>

      <div class="gallery-list" id="galleryList"></div>
    </section>
  </main>
</div>

<script>
  // ======== CONFIGURACI√ìN ========
  const API_BASE = "https://thesecretspot.onrender.com/api"; // <-- CAMBIA ESTO
  const TOKEN = "123456";                  // <-- MISMO QUE ADMIN_TOKEN

  // ======== CAMBIO DE PANEL ========
  function switchPanel(btn, panel){
    document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('section[id^="panel-"]').forEach(s => s.classList.add('hidden'));
    document.getElementById('panel-'+panel).classList.remove('hidden');
  }

  // ======== CARGAR CONTENIDO INICIAL ========
  async function loadContent(){
    try{
      const res = await fetch(API_BASE + "/content");
      const data = await res.json();

      // Video
      const heroPrev = document.getElementById('heroPreview');
      if(data.heroVideo){
        heroPrev.innerHTML = `<video src="${data.heroVideo}" controls muted loop></video>`;
      }else{
        heroPrev.innerHTML = `<p class="muted">No hay video configurado todav√≠a.</p>`;
      }

      // Slots
      const slots = data.slots || {};
      const allSlotKeys = [
        "servicio_1","servicio_2","servicio_3","servicio_4",
        "about_img","team_group",
        "staff_1","staff_2","staff_3","staff_4","staff_5","staff_6"
      ];
      allSlotKeys.forEach(k => {
        const img = document.getElementById("prev-"+k);
        if(!img) return;
        if(slots[k]){
          img.src = slots[k];
        } else {
          img.src = "";
          img.alt = "Sin imagen";
        }
      });

      // Galer√≠a
      renderGallery(data.gallery || []);
    }catch(e){
      console.error(e);
    }
  }

  // ======== HERO VIDEO ========
  async function uploadHeroVideo(){
    const fileInput = document.getElementById('heroFile');
    const status = document.getElementById('heroStatus');
    if(!fileInput.files[0]){
      alert("Selecciona un video");
      return;
    }

    const fd = new FormData();
    fd.append("file", fileInput.files[0]);

    status.textContent = "Subiendo video...";
    try{
      const res = await fetch(API_BASE + "/hero-video", {
        method: "POST",
        headers: { "Authorization": "Bearer " + TOKEN },
        body: fd
      });
      const data = await res.json();
      if(!res.ok){
        status.textContent = "Error: " + (data.detail || data.error || "no se pudo subir");
        return;
      }
      status.textContent = "Video actualizado ‚úî";
      fileInput.value = "";
      loadContent();
    }catch(e){
      console.error(e);
      status.textContent = "Error al subir video";
    }
  }

  // ======== SLOTS (IM√ÅGENES FIJAS) ========
  async function uploadSlot(slotKey){
    const fileInput = document.getElementById("file-"+slotKey);
    let statusEl;
    if(slotKey.startsWith("servicio_")) statusEl = document.getElementById("serviciosStatus");
    else if(slotKey === "about_img") statusEl = document.getElementById("sobreStatus");
    else if(slotKey === "team_group") statusEl = document.getElementById("grupoStatus");
    else if(slotKey.startsWith("staff_")) statusEl = document.getElementById("staffStatus");

    if(!fileInput.files[0]){
      alert("Selecciona una imagen");
      return;
    }

    const fd = new FormData();
    fd.append("slot_key", slotKey);
    fd.append("file", fileInput.files[0]);

    if(statusEl) statusEl.textContent = "Subiendo imagen...";
    try{
      const res = await fetch(API_BASE + "/slot-image", {
        method: "POST",
        headers: { "Authorization": "Bearer " + TOKEN },
        body: fd
      });
      const data = await res.json();
      if(!res.ok){
        if(statusEl) statusEl.textContent = "Error: " + (data.detail || data.error || "no se pudo subir");
        return;
      }
      if(statusEl) statusEl.textContent = "Imagen actualizada ‚úî";
      fileInput.value = "";
      loadContent();
    }catch(e){
      console.error(e);
      if(statusEl) statusEl.textContent = "Error al subir imagen";
    }
  }

  // ======== GALER√çA ========
  function renderGallery(items){
    const list = document.getElementById('galleryList');
    list.innerHTML = "";
    if(!items.length){
      list.innerHTML = `<p class="muted">A√∫n no hay im√°genes en la galer√≠a.</p>`;
      return;
    }
    items.slice().reverse().forEach(item => {
      const div = document.createElement('div');
      div.className = 'gallery-item';
      div.innerHTML = `
        <img src="${item.url}" alt="">
        <div class="gallery-meta">
          <div class="badge">${item.category}</div>
          <div class="muted">${item.id}</div>
        </div>
        <button class="danger" onclick="deleteGalleryItem('${item.id}')">Eliminar</button>
      `;
      list.appendChild(div);
    });
  }

  async function uploadGalleryImage(){
    const fileInput = document.getElementById('galleryFile');
    const category = document.getElementById('galleryCategory').value;
    const status = document.getElementById('galleryStatus');

    if(!fileInput.files[0]){
      alert("Selecciona una imagen");
      return;
    }

    const fd = new FormData();
    fd.append("file", fileInput.files[0]);
    fd.append("category", category);

    status.textContent = "Subiendo imagen...";
    try{
      const res = await fetch(API_BASE + "/gallery", {
        method: "POST",
        headers: { "Authorization": "Bearer " + TOKEN },
        body: fd
      });
      const data = await res.json();
      if(!res.ok){
        status.textContent = "Error: " + (data.detail || data.error || "no se pudo subir");
        return;
      }
      status.textContent = "Imagen a√±adida ‚úî";
      fileInput.value = "";
      loadContent();
    }catch(e){
      console.error(e);
      status.textContent = "Error al subir imagen";
    }
  }

  async function deleteGalleryItem(id){
    if(!confirm("¬øEliminar esta foto de la galer√≠a?")) return;
    try{
      const res = await fetch(API_BASE + "/gallery/" + id, {
        method: "DELETE",
        headers: { "Authorization": "Bearer " + TOKEN }
      });
      const data = await res.json();
      if(!res.ok){
        alert("Error: " + (data.detail || data.error || "no se pudo eliminar"));
        return;
      }
      loadContent();
    }catch(e){
      console.error(e);
      alert("Error al eliminar");
    }
  }

  // ======== INIT ========
  window.addEventListener("DOMContentLoaded", loadContent);
</script>

</body>
</html>
